"use strict";(self.webpackChunksocial_labs=self.webpackChunksocial_labs||[]).push([[316],{2516:(e,o,s)=>{s.r(o),s.d(o,{assets:()=>a,contentTitle:()=>c,default:()=>m,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"Docker/cap-7","title":"07 - Automatizando o Docker (DOING)","description":"Se voc\xea j\xe1 cansou de rodar docker run mil vezes s\xf3 pra subir um ambiente com v\xe1rios containers... Parab\xe9ns! Est\xe1 no lugar certo. Hoje vamos conhecer o glorioso Docker Compose \u2014 seu novo melhor amigo na orquestra\xe7\xe3o de containers.","source":"@site/cursos/Docker/cap07.md","sourceDirName":"Docker","slug":"/Docker/cap-7","permalink":"/docs/cursos/Docker/cap-7","draft":false,"unlisted":false,"editUrl":"https://github.com/SocialSoftwareLivingLab/docs/tree/main/site_source/cursos/Docker/cap07.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"cap-7","title":"07 - Automatizando o Docker (DOING)","sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"06 - Persist\xeancia de Dados","permalink":"/docs/cursos/Docker/cap-6"}}');var r=s(4848),d=s(8453);const i={id:"cap-7",title:"07 - Automatizando o Docker (DOING)",sidebar_position:7},c="Cap\xedtulo 7 - Docker Compose \ud83d\udc33\ud83d\udd27",a={},l=[{value:"\ud83e\udde0 O que \xe9 Docker Compose?",id:"-o-que-\xe9-docker-compose",level:2},{value:"\ud83d\ude80 Come\xe7ando com o B\xe1sico",id:"-come\xe7ando-com-o-b\xe1sico",level:2},{value:"1. Instalando o Docker Compose",id:"1-instalando-o-docker-compose",level:3},{value:"2. Criando seu primeiro <code>docker-compose.yml</code>",id:"2-criando-seu-primeiro-docker-composeyml",level:3},{value:"\ud83d\udee0 Estrutura de um Compose",id:"-estrutura-de-um-compose",level:2},{value:"\ud83e\udde9 V\xe1rios containers juntos: o poder do Compose",id:"-v\xe1rios-containers-juntos-o-poder-do-compose",level:2},{value:"\ud83d\udce6 Volumes, Networks e Ambientes",id:"-volumes-networks-e-ambientes",level:2},{value:"Volumes nomeados",id:"volumes-nomeados",level:3},{value:"Networks customizadas",id:"networks-customizadas",level:3},{value:"Vari\xe1veis de ambiente",id:"vari\xe1veis-de-ambiente",level:3},{value:"\ud83e\udde0 Avan\xe7ando: Comandos \xfateis",id:"-avan\xe7ando-comandos-\xfateis",level:2},{value:"\ud83d\udc19 Dicas Profundas (mas \xfateis)",id:"-dicas-profundas-mas-\xfateis",level:2},{value:"\u2705 Conclus\xe3o",id:"-conclus\xe3o",level:2},{value:"\ud83e\uddfe Resumo do Cap\xedtulo",id:"-resumo-do-cap\xedtulo",level:2},{value:"\ud83d\udcda Refer\xeancias",id:"-refer\xeancias",level:2}];function t(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"cap\xedtulo-7---docker-compose-",children:"Cap\xedtulo 7 - Docker Compose \ud83d\udc33\ud83d\udd27"})}),"\n",(0,r.jsxs)(o.p,{children:["Se voc\xea j\xe1 cansou de rodar ",(0,r.jsx)(o.code,{children:"docker run"})," mil vezes s\xf3 pra subir um ambiente com v\xe1rios containers... Parab\xe9ns! Est\xe1 no lugar certo. Hoje vamos conhecer o glorioso ",(0,r.jsx)(o.strong,{children:"Docker Compose"})," \u2014 seu novo melhor amigo na orquestra\xe7\xe3o de containers."]}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-o-que-\xe9-docker-compose",children:"\ud83e\udde0 O que \xe9 Docker Compose?"}),"\n",(0,r.jsx)(o.p,{children:"Imagine que voc\xea tem um app com:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"um backend em Node.js,"}),"\n",(0,r.jsx)(o.li,{children:"um banco de dados PostgreSQL,"}),"\n",(0,r.jsx)(o.li,{children:"e um Redis pra cache."}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Subir tudo isso na unha \xe9 poss\xedvel... mas cansativo. Com o Docker Compose, voc\xea ",(0,r.jsxs)(o.strong,{children:["define tudo em um arquivo ",(0,r.jsx)(o.code,{children:".yml"})]})," e sobe com um simples:"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"docker compose up\n"})}),"\n",(0,r.jsx)(o.admonition,{title:"Tradu\xe7\xe3o:",type:"tip",children:(0,r.jsx)(o.p,{children:"\xc9 como escrever um roteiro pro Docker e deixar ele fazer o trabalho pesado."})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-come\xe7ando-com-o-b\xe1sico",children:"\ud83d\ude80 Come\xe7ando com o B\xe1sico"}),"\n",(0,r.jsx)(o.h3,{id:"1-instalando-o-docker-compose",children:"1. Instalando o Docker Compose"}),"\n",(0,r.jsx)(o.admonition,{type:"note",children:(0,r.jsxs)(o.p,{children:["Desde o Docker 1.27+, o Compose j\xe1 vem embutido como ",(0,r.jsx)(o.code,{children:"docker compose"})," (sem o h\xedfen). Vers\xf5es antigas usam ",(0,r.jsx)(o.code,{children:"docker-compose"}),"."]})}),"\n",(0,r.jsx)(o.p,{children:"Verifique com:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",metastring:'title="Verificando o Compose"',children:"docker compose version\n"})}),"\n",(0,r.jsxs)(o.p,{children:["Se n\xe3o estiver instalado, siga ",(0,r.jsx)(o.a,{href:"https://docs.docker.com/compose/install/",children:"a documenta\xe7\xe3o oficial"}),"."]}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsxs)(o.h3,{id:"2-criando-seu-primeiro-docker-composeyml",children:["2. Criando seu primeiro ",(0,r.jsx)(o.code,{children:"docker-compose.yml"})]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:'version: "3.8"\nservices:\n  web:\n    image: nginx:latest\n    ports:\n      - "8080:80"\n'})}),"\n",(0,r.jsx)(o.p,{children:"Depois, rode:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"docker compose up\n"})}),"\n",(0,r.jsxs)(o.p,{children:["Pronto! Acesse ",(0,r.jsx)(o.code,{children:"http://localhost:8080"})," e veja o NGINX rodando. \ud83d\ude0e"]}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-estrutura-de-um-compose",children:"\ud83d\udee0 Estrutura de um Compose"}),"\n",(0,r.jsx)(o.p,{children:"Vamos decifrar o exemplo acima:"}),"\n",(0,r.jsxs)(o.table,{children:[(0,r.jsx)(o.thead,{children:(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.th,{children:"Chave"}),(0,r.jsx)(o.th,{children:"Significado"})]})}),(0,r.jsxs)(o.tbody,{children:[(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"version"})}),(0,r.jsxs)(o.td,{children:["Vers\xe3o da sintaxe do Compose. Use ",(0,r.jsx)(o.code,{children:"3.8"})," ou superior."]})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"services"})}),(0,r.jsx)(o.td,{children:"Define os containers que o Docker vai rodar."})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"image"})}),(0,r.jsx)(o.td,{children:"A imagem que ser\xe1 usada."})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"ports"})}),(0,r.jsx)(o.td,{children:"Mapeamento entre porta da m\xe1quina e do container."})]})]})]}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-v\xe1rios-containers-juntos-o-poder-do-compose",children:"\ud83e\udde9 V\xe1rios containers juntos: o poder do Compose"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",metastring:'title="Exemplo: Node.js + MongoDB"',children:'version: "3.8"\nservices:\n  backend:\n    build: .\n    ports:\n      - "3000:3000"\n    depends_on:\n      - mongo\n\n  mongo:\n    image: mongo\n    ports:\n      - "27017:27017"\n    volumes:\n      - mongo_data:/data/db\n\nvolumes:\n  mongo_data:\n'})}),"\n",(0,r.jsx)(o.admonition,{type:"tip",children:(0,r.jsxs)(o.p,{children:["Use ",(0,r.jsx)(o.code,{children:"depends_on"})," para garantir que o banco suba antes do backend. Mas cuidado: isso ",(0,r.jsx)(o.strong,{children:"n\xe3o garante que o Mongo esteja pronto para conex\xe3o"}),"! Use ",(0,r.jsx)(o.code,{children:"wait-for-it"})," ou implemente um retry no seu app."]})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-volumes-networks-e-ambientes",children:"\ud83d\udce6 Volumes, Networks e Ambientes"}),"\n",(0,r.jsx)(o.h3,{id:"volumes-nomeados",children:"Volumes nomeados"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:"volumes:\n  db_data:\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",children:"services:\n  db:\n    volumes:\n      - db_data:/var/lib/postgresql/data\n"})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h3,{id:"networks-customizadas",children:"Networks customizadas"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",children:"networks:\n  backend-net:\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",children:"services:\n  backend:\n    networks:\n      - backend-net\n"})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h3,{id:"vari\xe1veis-de-ambiente",children:"Vari\xe1veis de ambiente"}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.code,{children:".env"}),":"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-env",metastring:'title=".env"',children:"MONGO_USER=admin\nMONGO_PASS=123\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",children:"environment:\n  - MONGO_INITDB_ROOT_USERNAME=${MONGO_USER}\n  - MONGO_INITDB_ROOT_PASSWORD=${MONGO_PASS}\n"})}),"\n",(0,r.jsx)(o.admonition,{title:"Seguran\xe7a",type:"danger",children:(0,r.jsxs)(o.p,{children:["Nunca coloque senhas diretamente no ",(0,r.jsx)(o.code,{children:"docker-compose.yml"}),"."]})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-avan\xe7ando-comandos-\xfateis",children:"\ud83e\udde0 Avan\xe7ando: Comandos \xfateis"}),"\n",(0,r.jsxs)(o.table,{children:[(0,r.jsx)(o.thead,{children:(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.th,{children:"Comando"}),(0,r.jsx)(o.th,{children:"O que faz"})]})}),(0,r.jsxs)(o.tbody,{children:[(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"docker compose up"})}),(0,r.jsx)(o.td,{children:"Sobe os containers"})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"docker compose up -d"})}),(0,r.jsx)(o.td,{children:'Sobe em modo "detached" (em background)'})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"docker compose down"})}),(0,r.jsx)(o.td,{children:"Para e remove containers"})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"docker compose down -v"})}),(0,r.jsx)(o.td,{children:"Remove tamb\xe9m os volumes"})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"docker compose build"})}),(0,r.jsx)(o.td,{children:"Faz build das imagens"})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.code,{children:"docker system prune -a"})}),(0,r.jsx)(o.td,{children:"Limpa tudo (containers, volumes, imagens)"})]})]})]}),"\n",(0,r.jsx)(o.admonition,{type:"caution",children:(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.code,{children:"docker system prune -a"})," apaga ",(0,r.jsx)(o.strong,{children:"tudo"})," que n\xe3o estiver em uso. Use com cuidado."]})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-dicas-profundas-mas-\xfateis",children:"\ud83d\udc19 Dicas Profundas (mas \xfateis)"}),"\n",(0,r.jsx)(o.admonition,{type:"caution",children:(0,r.jsxs)(o.p,{children:["Evite usar ",(0,r.jsx)(o.code,{children:"latest"})," como tag da imagem em produ\xe7\xe3o. Isso pode mudar sem aviso e quebrar seu app."]})}),"\n",(0,r.jsx)(o.admonition,{type:"tip",children:(0,r.jsxs)(o.p,{children:["Coloque seu ",(0,r.jsx)(o.code,{children:"docker-compose.yml"})," e o ",(0,r.jsx)(o.code,{children:".env"})," na raiz do projeto. Isso facilita o deploy e manuten\xe7\xe3o."]})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-conclus\xe3o",children:"\u2705 Conclus\xe3o"}),"\n",(0,r.jsxs)(o.p,{children:["O Docker Compose \xe9 aquele ",(0,r.jsx)(o.strong,{children:"parceiro confi\xe1vel"})," que te ajuda a orquestrar ambientes complexos com eleg\xe2ncia. Neste cap\xedtulo voc\xea aprendeu a:"]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Criar ambientes multi-servi\xe7o;"}),"\n",(0,r.jsx)(o.li,{children:"Usar volumes, redes e vari\xe1veis de ambiente;"}),"\n",(0,r.jsx)(o.li,{children:"Utilizar comandos \xfateis do dia a dia;"}),"\n",(0,r.jsx)(o.li,{children:"Aplicar boas pr\xe1ticas de versionamento e seguran\xe7a."}),"\n"]}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-resumo-do-cap\xedtulo",children:"\ud83e\uddfe Resumo do Cap\xedtulo"}),"\n",(0,r.jsxs)(o.table,{children:[(0,r.jsx)(o.thead,{children:(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.th,{children:"Tema"}),(0,r.jsx)(o.th,{children:"O que voc\xea aprendeu"})]})}),(0,r.jsxs)(o.tbody,{children:[(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.strong,{children:"O que \xe9 Compose"})}),(0,r.jsx)(o.td,{children:"Forma de orquestrar m\xfaltiplos containers com YAML."})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.strong,{children:"Comandos principais"})}),(0,r.jsxs)(o.td,{children:[(0,r.jsx)(o.code,{children:"up"}),", ",(0,r.jsx)(o.code,{children:"down"}),", ",(0,r.jsx)(o.code,{children:"build"}),", ",(0,r.jsx)(o.code,{children:"logs"}),", ",(0,r.jsx)(o.code,{children:"exec"}),", entre outros."]})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.strong,{children:"Volumes e redes"})}),(0,r.jsx)(o.td,{children:"Como persistir dados e isolar servi\xe7os."})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.strong,{children:"Vari\xe1veis de ambiente"})}),(0,r.jsx)(o.td,{children:"Separar configs sens\xedveis e reaproveitar valores."})]}),(0,r.jsxs)(o.tr,{children:[(0,r.jsx)(o.td,{children:(0,r.jsx)(o.strong,{children:"Boas pr\xe1ticas"})}),(0,r.jsxs)(o.td,{children:["Evitar ",(0,r.jsx)(o.code,{children:"latest"}),", usar ",(0,r.jsx)(o.code,{children:".env"}),", usar ",(0,r.jsx)(o.code,{children:"depends_on"})," com cautela."]})]})]})]}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.h2,{id:"-refer\xeancias",children:"\ud83d\udcda Refer\xeancias"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["\ud83d\udcd6 ",(0,r.jsx)(o.a,{href:"https://docs.docker.com/compose/",children:"Documenta\xe7\xe3o oficial do Docker Compose"})]}),"\n",(0,r.jsxs)(o.li,{children:["\ud83d\udca1 ",(0,r.jsx)(o.a,{href:"https://github.com/docker/awesome-compose",children:"Awesome Compose (exemplos reais no GitHub)"})]}),"\n"]})]})}function m(e={}){const{wrapper:o}={...(0,d.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,o,s)=>{s.d(o,{R:()=>i,x:()=>c});var n=s(6540);const r={},d=n.createContext(r);function i(e){const o=n.useContext(d);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(d.Provider,{value:o},e.children)}}}]);